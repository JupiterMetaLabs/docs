"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2719],{4800:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"bft","title":"BFT Implementation Documentation","description":"\ud83d\udcc1 File Structure","source":"@site/docs/bft.md","sourceDirName":".","slug":"/bft","permalink":"/docs/bft","draft":false,"unlisted":false,"editUrl":"https://github.com/JupiterMetaZK/docs/edit/main/docs/bft.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"AVC (Asyncronous Validation Consensus) Module","permalink":"/docs/avc"},"next":{"title":"Sequencer Module","permalink":"/docs/sequencer"}}');var r=s(4848),o=s(8453);const i={},c="BFT Implementation Documentation",d={},l=[{value:"\ud83d\udcc1 File Structure",id:"-file-structure",level:2},{value:"<strong>Core BFT Logic</strong>",id:"core-bft-logic",level:3},{value:"<strong>Communication</strong> (How They Talk)",id:"communication-how-they-talk",level:3},{value:"<strong>Network Setup</strong>",id:"network-setup",level:3},{value:"<strong>Testing</strong>",id:"testing",level:3},{value:"\ud83c\udfac The Flow (Step by Step)",id:"-the-flow-step-by-step",level:2},{value:"<strong>Step 1: Setup</strong> (Before anything happens)",id:"step-1-setup-before-anything-happens",level:3},{value:"<strong>Step 2: Sequencer Triggers BFT</strong> (New block needs validation)",id:"step-2-sequencer-triggers-bft-new-block-needs-validation",level:3},{value:"<strong>Step 3: Buddy Receives Request</strong>",id:"step-3-buddy-receives-request",level:3},{value:"<strong>Step 4: Buddy Joins GossipSub</strong>",id:"step-4-buddy-joins-gossipsub",level:3},{value:"<strong>Step 5: BFT Runs</strong> (The Main Event!)",id:"step-5-bft-runs-the-main-event",level:3},{value:"<strong>Phase 3a: PREPARE</strong>",id:"phase-3a-prepare",level:4},{value:"<strong>Phase 3b: COMMIT</strong>",id:"phase-3b-commit",level:4},{value:"<strong>Step 6: Report Back to Sequencer</strong>",id:"step-6-report-back-to-sequencer",level:3},{value:"<strong>Step 7: Sequencer Collects Results</strong>",id:"step-7-sequencer-collects-results",level:3}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"bft-implementation-documentation",children:"BFT Implementation Documentation"})}),"\n",(0,r.jsx)(n.h2,{id:"-file-structure",children:"\ud83d\udcc1 File Structure"}),"\n",(0,r.jsx)(n.h3,{id:"core-bft-logic",children:(0,r.jsx)(n.strong,{children:"Core BFT Logic"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"pkg/bft/\n\u251c\u2500\u2500 types.go              \u2192 Defines what things are (Config, Decision, etc.)\n\u251c\u2500\u2500 bft.go                \u2192 Main BFT boss (starts everything)\n\u251c\u2500\u2500 engine.go             \u2192 Does PREPARE & COMMIT phases\n\u251c\u2500\u2500 byzantine.go          \u2192 Catches cheaters\n\u2514\u2500\u2500 simulator.go          \u2192 Fake network for testing\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"communication-how-they-talk",children:[(0,r.jsx)(n.strong,{children:"Communication"})," (How They Talk)"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:'pkg/bft/\n\u251c\u2500\u2500 gossipsub_messenger.go \u2192 Real network messenger (Production)\n\u251c\u2500\u2500 buddy_service.go       \u2192 Buddy\'s gRPC server (listens for jobs)\n\u251c\u2500\u2500 sequencer_client.go    \u2192 Sequencer tells buddies "start!"\n\u2514\u2500\u2500 sequencer_server.go    \u2192 Sequencer collects results\n'})}),"\n",(0,r.jsx)(n.h3,{id:"network-setup",children:(0,r.jsx)(n.strong,{children:"Network Setup"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"pkg/network/\n\u2514\u2500\u2500 libp2p_setup.go       \u2192 Creates the network connections\n"})}),"\n",(0,r.jsx)(n.h3,{id:"testing",children:(0,r.jsx)(n.strong,{children:"Testing"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"pkg/bft/\n\u2514\u2500\u2500 bft_test.go           \u2192 Unit tests\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-the-flow-step-by-step",children:"\ud83c\udfac The Flow (Step by Step)"}),"\n",(0,r.jsxs)(n.h3,{id:"step-1-setup-before-anything-happens",children:[(0,r.jsx)(n.strong,{children:"Step 1: Setup"})," (Before anything happens)"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"Each Buddy Node:\n  1. Start libp2p (network connection)\n  2. Start GossipSub (group chat)\n  3. Start gRPC server (phone line for Sequencer)\n  \nSequencer:\n  1. Start gRPC server (to receive results)\n  2. Connect to Peer Directory\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"step-2-sequencer-triggers-bft-new-block-needs-validation",children:[(0,r.jsx)(n.strong,{children:"Step 2: Sequencer Triggers BFT"})," (New block needs validation)"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:'Sequencer:\n  1. Picks 13 buddies using VRF\n  2. Creates GossipSub topic: "round-123"\n  3. Sends gRPC message to all 13:\n     "Join topic \'round-123\' and run BFT!"\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"File used:"})," ",(0,r.jsx)(n.code,{children:"sequencer_client.go"})," \u2192 ",(0,r.jsx)(n.code,{children:"InitiateBFTRound()"})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"step-3-buddy-receives-request",children:(0,r.jsx)(n.strong,{children:"Step 3: Buddy Receives Request"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:'Each Buddy:\n  1. gRPC server receives message\n  2. "Oh! Sequencer wants me to run BFT!"\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"File used:"})," ",(0,r.jsx)(n.code,{children:"buddy_service.go"})," \u2192 ",(0,r.jsx)(n.code,{children:"InitiateBFT()"})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"step-4-buddy-joins-gossipsub",children:(0,r.jsx)(n.strong,{children:"Step 4: Buddy Joins GossipSub"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:'Each Buddy:\n  1. Joins GossipSub topic "round-123"\n  2. Waits for all 13 buddies to join\n  3. Network mesh forms (everyone connected)\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"File used:"})," ",(0,r.jsx)(n.code,{children:"gossipsub_messenger.go"})," \u2192 ",(0,r.jsx)(n.code,{children:"NewGossipSubMessenger()"})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h3,{id:"step-5-bft-runs-the-main-event",children:[(0,r.jsx)(n.strong,{children:"Step 5: BFT Runs"})," (The Main Event!)"]}),"\n",(0,r.jsx)(n.h4,{id:"phase-3a-prepare",children:(0,r.jsx)(n.strong,{children:"Phase 3a: PREPARE"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"Each of 13 buddies:\n  1. Decides ACCEPT or REJECT (based on 87 votes)\n  2. Broadcasts PREPARE message on GossipSub\n  3. Listens for PREPARE from other 12 buddies\n  4. Counts votes: Need 9+ to match\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Files used:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"bft.go"})," \u2192 ",(0,r.jsx)(n.code,{children:"RunConsensus()"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"engine.go"})," \u2192 ",(0,r.jsx)(n.code,{children:"runPrepare()"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"gossipsub_messenger.go"})," \u2192 ",(0,r.jsx)(n.code,{children:"BroadcastPrepare()"}),", ",(0,r.jsx)(n.code,{children:"ReceivePrepare()"})]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"phase-3b-commit",children:(0,r.jsx)(n.strong,{children:"Phase 3b: COMMIT"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"Each buddy (if 9+ agreed in PREPARE):\n  1. Creates COMMIT with proof of 9+ PREPARE votes\n  2. Broadcasts COMMIT on GossipSub\n  3. Listens for COMMIT from others\n  4. Once 9+ COMMIT received \u2192 Consensus reached!\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Files used:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"engine.go"})," \u2192 ",(0,r.jsx)(n.code,{children:"runCommit()"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"gossipsub_messenger.go"})," \u2192 ",(0,r.jsx)(n.code,{children:"BroadcastCommit()"}),", ",(0,r.jsx)(n.code,{children:"ReceiveCommit()"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"byzantine.go"})," \u2192 Checks for cheaters"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"step-6-report-back-to-sequencer",children:(0,r.jsx)(n.strong,{children:"Step 6: Report Back to Sequencer"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:'Each Buddy:\n  1. BFT finished (SUCCESS or FAIL)\n  2. Sends result via gRPC to Sequencer\n  3. "Hey boss, my answer is ACCEPT!"\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"File used:"})," ",(0,r.jsx)(n.code,{children:"buddy_service.go"})," \u2192 ",(0,r.jsx)(n.code,{children:"reportResult()"})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"step-7-sequencer-collects-results",children:(0,r.jsx)(n.strong,{children:"Step 7: Sequencer Collects Results"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:'Sequencer:\n  1. Receives results from buddies (via gRPC server)\n  2. Waits until 9+ results received\n  3. Final decision: ACCEPT or REJECT\n  4. "Block is ACCEPTED! \u2705"\n'})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>c});var t=s(6540);const r={},o=t.createContext(r);function i(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);