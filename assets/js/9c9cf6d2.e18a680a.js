"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1697],{6558:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>t,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"block","title":"Block Module","description":"Overview","source":"@site/docs/block.md","sourceDirName":".","slug":"/block","permalink":"/docs/block","draft":false,"unlisted":false,"editUrl":"https://github.com/JupiterMetaZK/docs/edit/main/docs/block.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Sequencer Module","permalink":"/docs/sequencer"},"next":{"title":"Block gRPC Server","permalink":"/docs/block-gRPC"}}');var l=s(4848),r=s(8453);const o={},c="Block Module",t={},a=[{value:"Overview",id:"overview",level:2},{value:"Purpose",id:"purpose",level:2},{value:"Key Components",id:"key-components",level:2},{value:"1. HTTP API Server",id:"1-http-api-server",level:3},{value:"2. gRPC Server",id:"2-grpc-server",level:3},{value:"3. gRPC Client",id:"3-grpc-client",level:3},{value:"4. Smart Contract Server",id:"4-smart-contract-server",level:3},{value:"5. Utilities",id:"5-utilities",level:3},{value:"Key Functions",id:"key-functions",level:2},{value:"Block Processing",id:"block-processing",level:3},{value:"Transaction Submission",id:"transaction-submission",level:3},{value:"Block Retrieval",id:"block-retrieval",level:3},{value:"Block Processing Flow",id:"block-processing-flow",level:2},{value:"Integration Points",id:"integration-points",level:2},{value:"Mempool Service",id:"mempool-service",level:3},{value:"Sequencer Module",id:"sequencer-module",level:3},{value:"Database (DB_OPs)",id:"database-db_ops",level:3},{value:"Messaging Module",id:"messaging-module",level:3},{value:"Configuration",id:"configuration",level:2},{value:"API Endpoints",id:"api-endpoints",level:2},{value:"HTTP Endpoints",id:"http-endpoints",level:3},{value:"gRPC Service",id:"grpc-service",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Logging",id:"logging",level:2},{value:"Security",id:"security",level:2},{value:"Performance",id:"performance",level:2},{value:"Testing",id:"testing",level:2},{value:"Usage Example",id:"usage-example",level:2},{value:"Future Enhancements",id:"future-enhancements",level:2}];function d(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"block-module",children:"Block Module"})}),"\n",(0,l.jsx)(e.h2,{id:"overview",children:"Overview"}),"\n",(0,l.jsx)(e.p,{children:"The Block module handles blockchain operations, transaction processing, block generation, and block validation. It provides both HTTP API and gRPC interfaces for block operations and integrates with the mempool service for transaction management."}),"\n",(0,l.jsx)(e.h2,{id:"purpose",children:"Purpose"}),"\n",(0,l.jsx)(e.p,{children:"The Block module is responsible for:"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Processing ZK-verified blocks from the ZKVM"}),"\n",(0,l.jsx)(e.li,{children:"Submitting raw transactions to the mempool"}),"\n",(0,l.jsx)(e.li,{children:"Storing validated blocks in the database"}),"\n",(0,l.jsx)(e.li,{children:"Providing block retrieval APIs"}),"\n",(0,l.jsx)(e.li,{children:"Managing consensus for block validation"}),"\n",(0,l.jsx)(e.li,{children:"Executing smart contracts"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"key-components",children:"Key Components"}),"\n",(0,l.jsx)(e.h3,{id:"1-http-api-server",children:"1. HTTP API Server"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"File:"})," ",(0,l.jsx)(e.code,{children:"Server.go"})]}),"\n",(0,l.jsx)(e.p,{children:"Provides RESTful HTTP API endpoints for block operations:"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"POST /submit-raw-transaction"}),": Submit raw transactions"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"POST /process-zk-block"}),": Process ZK-verified blocks"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"POST /process-zk-block-no-consensus"}),": Process blocks without consensus (testing)"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"GET /block/:number"}),": Get block by number"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"GET /block/:hash"}),": Get block by hash"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"2-grpc-server",children:"2. gRPC Server"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"File:"})," ",(0,l.jsx)(e.code,{children:"grpc_server.go"})]}),"\n",(0,l.jsx)(e.p,{children:"Provides gRPC service for block processing:"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"ProcessBlock"}),": Process blocks via gRPC"]}),"\n",(0,l.jsx)(e.li,{children:"Block validation and consensus integration"}),"\n",(0,l.jsx)(e.li,{children:"Transaction logging"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"3-grpc-client",children:"3. gRPC Client"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"File:"})," ",(0,l.jsx)(e.code,{children:"gRPCclient.go"})]}),"\n",(0,l.jsx)(e.p,{children:"Client for communicating with the mempool service:"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Submit transactions to mempool"}),"\n",(0,l.jsx)(e.li,{children:"Query mempool status"}),"\n",(0,l.jsx)(e.li,{children:"Transaction validation"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"4-smart-contract-server",children:"4. Smart Contract Server"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"File:"})," ",(0,l.jsx)(e.code,{children:"SmartcontractServer.go"})]}),"\n",(0,l.jsx)(e.p,{children:"Handles smart contract execution and interaction."}),"\n",(0,l.jsx)(e.h3,{id:"5-utilities",children:"5. Utilities"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"Files:"})," ",(0,l.jsx)(e.code,{children:"Blockhelper.go"}),", ",(0,l.jsx)(e.code,{children:"utils.go"})]}),"\n",(0,l.jsx)(e.p,{children:"Helper functions for:"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Transaction logging"}),"\n",(0,l.jsx)(e.li,{children:"Block conversion"}),"\n",(0,l.jsx)(e.li,{children:"Block validation"}),"\n",(0,l.jsx)(e.li,{children:"Merkle tree operations"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"key-functions",children:"Key Functions"}),"\n",(0,l.jsx)(e.h3,{id:"block-processing",children:"Block Processing"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:"// Process ZK-verified block\nfunc processZKBlock(c *gin.Context) {\n    // Validates block\n    // Starts consensus process\n    // Stores block in database\n    // Logs transactions\n}\n"})}),"\n",(0,l.jsx)(e.h3,{id:"transaction-submission",children:"Transaction Submission"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:"// Submit raw transaction to mempool\nfunc SubmitRawTransaction(tx *config.Transaction) (string, error) {\n    // Validates transaction\n    // Submits to mempool via gRPC\n    // Returns transaction hash\n}\n"})}),"\n",(0,l.jsx)(e.h3,{id:"block-retrieval",children:"Block Retrieval"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:"// Get block by number\nfunc GetBlockByNumber(number uint64) (*config.ZKBlock, error)\n\n// Get block by hash\nfunc GetBlockByHash(hash common.Hash) (*config.ZKBlock, error)\n"})}),"\n",(0,l.jsx)(e.h2,{id:"block-processing-flow",children:"Block Processing Flow"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Block Reception"}),": Block received via HTTP API or gRPC"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Validation"}),": Validates block structure and transactions"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Consensus"}),": Initiates consensus process via Sequencer"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Storage"}),": Stores validated block in main database"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Propagation"}),": Propagates block to network peers"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Logging"}),": Logs all transactions in the block"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"integration-points",children:"Integration Points"}),"\n",(0,l.jsx)(e.h3,{id:"mempool-service",children:"Mempool Service"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Submits transactions via gRPC"}),"\n",(0,l.jsx)(e.li,{children:"Queries transaction status"}),"\n",(0,l.jsx)(e.li,{children:"Validates transaction format"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"sequencer-module",children:"Sequencer Module"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Initiates consensus for block validation"}),"\n",(0,l.jsx)(e.li,{children:"Manages buddy node selection"}),"\n",(0,l.jsx)(e.li,{children:"Collects consensus results"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"database-db_ops",children:"Database (DB_OPs)"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Stores validated blocks"}),"\n",(0,l.jsx)(e.li,{children:"Retrieves block data"}),"\n",(0,l.jsx)(e.li,{children:"Manages block metadata"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"messaging-module",children:"Messaging Module"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Propagates blocks to network peers"}),"\n",(0,l.jsx)(e.li,{children:"Broadcasts block updates"}),"\n",(0,l.jsx)(e.li,{children:"Handles block synchronization"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"configuration",children:"Configuration"}),"\n",(0,l.jsxs)(e.p,{children:["Key configuration in ",(0,l.jsx)(e.code,{children:"config/"}),":"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"ZKBlock"}),": Block data structure"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"Transaction"}),": Transaction data structure"]}),"\n",(0,l.jsx)(e.li,{children:"Block processing timeouts"}),"\n",(0,l.jsx)(e.li,{children:"Consensus parameters"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"api-endpoints",children:"API Endpoints"}),"\n",(0,l.jsx)(e.h3,{id:"http-endpoints",children:"HTTP Endpoints"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Submit Transaction:"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'POST /submit-raw-transaction\nContent-Type: application/json\n\n{\n  "from": "0x...",\n  "to": "0x...",\n  "value": "1000000000000000000",\n  "nonce": 1,\n  "gasLimit": 21000,\n  "gasPrice": "20000000000",\n  "data": "0x"\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Process Block:"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'POST /process-zk-block\nContent-Type: application/json\n\n{\n  "blockNumber": 123,\n  "blockHash": "0x...",\n  "transactions": [...],\n  "status": "verified"\n}\n'})}),"\n",(0,l.jsx)(e.h3,{id:"grpc-service",children:"gRPC Service"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"ProcessBlock:"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-protobuf",children:"service BlockService {\n    rpc ProcessBlock(ProcessBlockRequest) returns (ProcessBlockResponse);\n}\n"})}),"\n",(0,l.jsx)(e.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,l.jsx)(e.p,{children:"The module includes comprehensive error handling:"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Invalid block format errors"}),"\n",(0,l.jsx)(e.li,{children:"Transaction validation errors"}),"\n",(0,l.jsx)(e.li,{children:"Database connection errors"}),"\n",(0,l.jsx)(e.li,{children:"Consensus failures"}),"\n",(0,l.jsx)(e.li,{children:"Mempool communication errors"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"logging",children:"Logging"}),"\n",(0,l.jsx)(e.p,{children:"Transaction and block operations are logged to:"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"logs/transactions.log"}),": Transaction logs"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"logs/block-grpc.log"}),": gRPC block operations"]}),"\n",(0,l.jsx)(e.li,{children:"Loki (if enabled): Centralized logging"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"security",children:"Security"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Transaction signature verification"}),"\n",(0,l.jsx)(e.li,{children:"Block hash validation"}),"\n",(0,l.jsx)(e.li,{children:"Consensus validation before storage"}),"\n",(0,l.jsx)(e.li,{children:"Input sanitization"}),"\n",(0,l.jsx)(e.li,{children:"Rate limiting (via middleware)"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"performance",children:"Performance"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Concurrent block processing"}),"\n",(0,l.jsx)(e.li,{children:"Batch transaction operations"}),"\n",(0,l.jsx)(e.li,{children:"Efficient database queries"}),"\n",(0,l.jsx)(e.li,{children:"Connection pooling for mempool"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"testing",children:"Testing"}),"\n",(0,l.jsx)(e.p,{children:"Test files:"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"Block_test.go"}),": Block processing tests"]}),"\n",(0,l.jsx)(e.li,{children:"Integration tests with mempool"}),"\n",(0,l.jsx)(e.li,{children:"Consensus integration tests"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"usage-example",children:"Usage Example"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'import "gossipnode/Block"\n\n// Start HTTP server\nBlock.Startserver(8080, host, chainID)\n\n// Start gRPC server\nBlock.StartGRPCServer(9090, host, chainID)\n\n// Submit transaction\nhash, err := Block.SubmitRawTransaction(&tx)\n\n// Process block\nerr := Block.ProcessZKBlock(&block)\n'})}),"\n",(0,l.jsx)(e.h2,{id:"future-enhancements",children:"Future Enhancements"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Enhanced block validation"}),"\n",(0,l.jsx)(e.li,{children:"Improved consensus integration"}),"\n",(0,l.jsx)(e.li,{children:"Advanced smart contract support"}),"\n",(0,l.jsx)(e.li,{children:"Block pruning and archival"}),"\n",(0,l.jsx)(e.li,{children:"Performance optimizations"}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(d,{...n})}):d(n)}},8453:(n,e,s)=>{s.d(e,{R:()=>o,x:()=>c});var i=s(6540);const l={},r=i.createContext(l);function o(n){const e=i.useContext(r);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:o(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);