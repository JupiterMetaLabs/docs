"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3677],{8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>d});var r=s(6540);const i={},t=r.createContext(i);function l(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(t.Provider,{value:n},e.children)}},9618:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"seednode-core","title":"Seed Node","description":"A decentralized peer directory service for the JMDT network.","source":"@site/docs/seednode-core.md","sourceDirName":".","slug":"/seednode-core","permalink":"/docs/seednode-core","draft":false,"unlisted":false,"editUrl":"https://github.com/JupiterMetaZK/docs/edit/main/docs/seednode-core.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Tokenomics","permalink":"/docs/tokenomics"},"next":{"title":"P2P-Communication","permalink":"/docs/jmdt-node"}}');var i=s(4848),t=s(8453);const l={},d="Seed Node",o={},a=[{value:"\ud83d\ude80 Quick Start",id:"-quick-start",level:2},{value:"1. Start PostgreSQL",id:"1-start-postgresql",level:3},{value:"2. Start the Peer Directory Service",id:"2-start-the-peer-directory-service",level:3},{value:"3. Start the Web UI",id:"3-start-the-web-ui",level:3},{value:"4. Access the System",id:"4-access-the-system",level:3},{value:"\u2728 Features",id:"-features",level:2},{value:"\ud83d\udd04 Recent Updates",id:"-recent-updates",level:2},{value:"Peer Directory v2 - Normalized Data Model (v4.0) - <strong>MAJOR UPDATE</strong>",id:"peer-directory-v2---normalized-data-model-v40---major-update",level:3},{value:"<strong>What&#39;s New:</strong>",id:"whats-new",level:4},{value:"<strong>New gRPC Endpoints:</strong>",id:"new-grpc-endpoints",level:4},{value:"<strong>Data Model Changes:</strong>",id:"data-model-changes",level:4},{value:"<strong>Breaking Changes:</strong>",id:"breaking-changes",level:4},{value:"Database Health Checks &amp; Auto-Setup (v3.1) - <strong>FEATURE</strong>",id:"database-health-checks--auto-setup-v31---feature",level:3},{value:"<strong>What&#39;s New:</strong>",id:"whats-new-1",level:4},{value:"<strong>Default Configuration:</strong>",id:"default-configuration",level:4},{value:"<strong>Service Startup Process:</strong>",id:"service-startup-process",level:4},{value:"<strong>Error Handling:</strong>",id:"error-handling",level:4},{value:"GORM Migration (v3.0) - <strong>MAJOR UPDATE</strong>",id:"gorm-migration-v30---major-update",level:3},{value:"<strong>What Changed:</strong>",id:"what-changed",level:4},{value:"<strong>Technical Improvements:</strong>",id:"technical-improvements",level:4},{value:"<strong>Performance Benefits:</strong>",id:"performance-benefits",level:4},{value:"<strong>Backward Compatibility:</strong>",id:"backward-compatibility",level:4},{value:"Binary Status System (v2.0)",id:"binary-status-system-v20",level:3},{value:"\ud83c\udf0d IP Geolocation (v3.2) - <strong>NEW FEATURE</strong>",id:"-ip-geolocation-v32---new-feature",level:2},{value:"<strong>What&#39;s New:</strong>",id:"whats-new-2",level:3},{value:"<strong>Supported Services:</strong>",id:"supported-services",level:3},{value:"<strong>IP-API</strong> (Default - Free)",id:"ip-api-default---free",level:4},{value:"<strong>ipapi.co</strong> (Optional - Paid)",id:"ipapico-optional---paid",level:4},{value:"<strong>Configuration:</strong>",id:"configuration",level:3},{value:"<strong>Environment Variables:</strong>",id:"environment-variables",level:4},{value:"<strong>Programmatic Configuration:</strong>",id:"programmatic-configuration",level:4},{value:"<strong>Region Format:</strong>",id:"region-format",level:3},{value:"<strong>Automatic Integration:</strong>",id:"automatic-integration",level:3},{value:"<strong>Database Storage:</strong>",id:"database-storage",level:3},{value:"<strong>Setup Guide:</strong>",id:"setup-guide",level:3},{value:"\u2696\ufe0f Peer Weights System (v3.3) - <strong>NEW FEATURE</strong>",id:"\ufe0f-peer-weights-system-v33---new-feature",level:2},{value:"<strong>What&#39;s New:</strong>",id:"whats-new-3",level:3},{value:"<strong>Use Cases:</strong>",id:"use-cases",level:3},{value:"<strong>API Usage:</strong>",id:"api-usage",level:3},{value:"<strong>Weight Values:</strong>",id:"weight-values",level:3},{value:"\ud83d\udc65 Buddy Management (v4.1) - <strong>NEW FEATURE</strong>",id:"-buddy-management-v41---new-feature",level:2},{value:"<strong>What&#39;s New:</strong>",id:"whats-new-4",level:3},{value:"<strong>How It Works:</strong>",id:"how-it-works",level:3},{value:"<strong>UpdateBuddy</strong>",id:"updatebuddy",level:4},{value:"<strong>ListBuddy</strong>",id:"listbuddy",level:4},{value:"<strong>Database Schema:</strong>",id:"database-schema",level:3},{value:"<strong>Use Cases:</strong>",id:"use-cases-1",level:3},{value:"<strong>API Usage:</strong>",id:"api-usage-1",level:3},{value:"<strong>Response Examples:</strong>",id:"response-examples",level:3},{value:"<strong>UpdateBuddy Response:</strong>",id:"updatebuddy-response",level:4},{value:"<strong>ListBuddy Response:</strong>",id:"listbuddy-response",level:4},{value:"<strong>Automatic Limit Management:</strong>",id:"automatic-limit-management",level:3},{value:"\ud83c\udfd7\ufe0f GORM Architecture",id:"\ufe0f-gorm-architecture",level:2},{value:"Database Layer Structure",id:"database-layer-structure",level:3},{value:"GORM Models",id:"gorm-models",level:3},{value:"PeerRecord",id:"peerrecord",level:4},{value:"GormPeerAlias",id:"gormpeeralias",level:4},{value:"Heartbeat",id:"heartbeat",level:4},{value:"Key GORM Features",id:"key-gorm-features",level:3},{value:"Database Schema",id:"database-schema-1",level:3},{value:"peer_records",id:"peer_records",level:4},{value:"\ud83d\udce6 Data Models",id:"-data-models",level:2},{value:"Signed Peer Record v3 (GORM)",id:"signed-peer-record-v3-gorm",level:3},{value:"One-shot Dependency Install",id:"one-shot-dependency-install",level:2},{value:"Build Binaries",id:"build-binaries",level:2},{value:"Run",id:"run",level:2},{value:"BatchDelete",id:"batchdelete",level:4},{value:"Get (reads directly from Postgres)",id:"get-reads-directly-from-postgres",level:4},{value:"List (keyset pagination)",id:"list-keyset-pagination",level:4},{value:"Peer Directory Service (JMNS)",id:"peer-directory-service-jmns",level:2},{value:"Option 1: Using Docker PostgreSQL",id:"option-1-using-docker-postgresql",level:3},{value:"Option 2: Using Native PostgreSQL (Ubuntu/Debian)",id:"option-2-using-native-postgresql-ubuntudebian",level:3},{value:"Testing",id:"testing",level:3},{value:"\ud83c\udf10 Web UI",id:"-web-ui",level:2},{value:"Start the Web UI",id:"start-the-web-ui",level:3},{value:"Features",id:"features",level:3},{value:"API Endpoints",id:"api-endpoints",level:3},{value:"\ud83d\udd0c gRPC API Reference",id:"-grpc-api-reference",level:2},{value:"Core Operations",id:"core-operations",level:3},{value:"Alias Operations",id:"alias-operations",level:3},{value:"Neighbor Management (NEW)",id:"neighbor-management-new",level:3},{value:"Inactive Peer Reporting (NEW)",id:"inactive-peer-reporting-new",level:3},{value:"Health Checks (NEW)",id:"health-checks-new",level:3},{value:"Heartbeat &amp; Service Operations",id:"heartbeat--service-operations",level:3},{value:"Status Values",id:"status-values",level:3},{value:"Weights System",id:"weights-system",level:3},{value:"Example gRPC Calls",id:"example-grpc-calls",level:3},{value:"\ud83d\udcc1 Project Structure",id:"-project-structure",level:2},{value:"\ud83e\uddea Testing",id:"-testing",level:2},{value:"Test Organization",id:"test-organization",level:3},{value:"Running Tests",id:"running-tests",level:3},{value:"Test Coverage",id:"test-coverage",level:3},{value:"\ud83d\udd27 Troubleshooting",id:"-troubleshooting",level:2},{value:"Common Issues &amp; Solutions",id:"common-issues--solutions",level:3},{value:"<strong>PostgreSQL Not Running</strong>",id:"postgresql-not-running",level:4},{value:"<strong>Database Permission Issues</strong>",id:"database-permission-issues",level:4},{value:"<strong>Schema Application Failed</strong>",id:"schema-application-failed",level:4},{value:"<strong>Service Won&#39;t Start</strong>",id:"service-wont-start",level:4},{value:"<strong>Protobuf Field Errors</strong>",id:"protobuf-field-errors",level:4},{value:"Service Configuration",id:"service-configuration",level:3},{value:"<strong>Environment Variables</strong>",id:"environment-variables-1",level:4},{value:"<strong>Command Line Options</strong>",id:"command-line-options",level:4},{value:"Logging &amp; Monitoring",id:"logging--monitoring",level:3},{value:"Local Redis Streams and Postgres",id:"local-redis-streams-and-postgres",level:2}];function c(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"seed-node",children:"Seed Node"})}),"\n",(0,i.jsxs)(n.p,{children:["A decentralized ",(0,i.jsx)(n.strong,{children:"peer directory service"})," for the JMDT network.",(0,i.jsx)(n.br,{}),"\n","The system maps ",(0,i.jsx)(n.strong,{children:"PeerIDs \u2192 IPs/multiaddrs + metadata"}),", and optionally supports ",(0,i.jsx)(n.strong,{children:"human-readable names"})," (",(0,i.jsx)(n.code,{children:"alice.node.jmdt"}),") as aliases."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-quick-start",children:"\ud83d\ude80 Quick Start"}),"\n",(0,i.jsx)(n.h3,{id:"1-start-postgresql",children:"1. Start PostgreSQL"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Using Docker (recommended)\ndocker run --name postgres-jmns -e POSTGRES_PASSWORD=postgres -e POSTGRES_DB=postgres -p 5432:5432 -d postgres:15\n\n# Note: Database and schema are automatically created by the service\n# The service will create the 'jmns' database and apply the schema automatically\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-start-the-peer-directory-service",children:"2. Start the Peer Directory Service"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Build and start the JMNS service (with automatic database setup)\ngo build -o jmns-service cmd/jmns-service/main.go\n\n# The service will automatically:\n# - Check if PostgreSQL is running (fails if not)\n# - Create the 'jmns' database if it doesn't exist\n# - Apply the schema if tables don't exist\n# - Start the gRPC server\n\n# Custom configuration\n./jmns-service -port 17002 -pg-dsn \"postgres://user:pass@host:port/dbname?sslmode=disable\"\n\n# Using environment variables\nPG_DSN=\"postgres://postgres:postgres@localhost:5432/jmns?sslmode=disable\" ./jmns-service -port 17002\n\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-start-the-web-ui",children:"3. Start the Web UI"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Build and start the web UI\ngo build -o bin/peer-ui cmd/peer-ui/main.go\n./bin/peer-ui\n"})}),"\n",(0,i.jsx)(n.h3,{id:"4-access-the-system",children:"4. Access the System"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Web UI"}),": ",(0,i.jsx)(n.a,{href:"http://localhost:8080",children:"http://localhost:8080"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"gRPC API"}),": localhost:17002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"REST API"}),": ",(0,i.jsx)(n.a,{href:"http://localhost:8080/api/peers",children:"http://localhost:8080/api/peers"})]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-features",children:"\u2728 Features"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Canonical identity"}),":",(0,i.jsx)(n.br,{}),"\n","Every node is anchored to its ",(0,i.jsx)(n.strong,{children:"PeerID"})," (Ed25519-based)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Alias support"}),":",(0,i.jsx)(n.br,{}),"\n","Human-friendly names like ",(0,i.jsx)(n.code,{children:"alice.node.jmdt"})," mapped to PeerIDs (ENS-style)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Peer records"}),":",(0,i.jsx)(n.br,{}),"\n","Store IPv4/IPv6, multiaddrs, neighbor connections, and binary status (",(0,i.jsx)(n.code,{children:"active/inactive"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"V, R, S signature format"}),":",(0,i.jsx)(n.br,{}),"\n","Uses Ethereum-compatible V, R, S signature components for cryptographic verification."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Auto-generated timestamps"}),":",(0,i.jsx)(n.br,{}),"\n","Timestamps are automatically generated server-side for consistency."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Auto-active status"}),":",(0,i.jsx)(n.br,{}),"\n","New peer registrations are automatically marked as active."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Signed updates"}),":",(0,i.jsx)(n.br,{}),"\n","Only the PeerID owner can update their record."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Fast lookups"}),":",(0,i.jsx)(n.br,{}),"\n","PostgreSQL-based storage for fast and reliable reads."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Durable source of truth"}),":",(0,i.jsx)(n.br,{}),"\n","PostgreSQL database stores all peer records and aliases."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Dynamic liveness"}),":",(0,i.jsx)(n.br,{}),"\n","Heartbeat messages for real-time status tracking."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Auditability"}),":",(0,i.jsx)(n.br,{}),"\n","Complete audit trail with timestamps and signatures."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Binary Status System"}),":",(0,i.jsx)(n.br,{}),"\n","Simple active/inactive status with clear visual indicators."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\ud83c\udd95 Automatic Database Setup"}),":",(0,i.jsx)(n.br,{}),"\n","Service automatically creates database and applies schema on startup."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\ud83c\udd95 Health Checks"}),":",(0,i.jsx)(n.br,{}),"\n","Comprehensive PostgreSQL connectivity and database validation."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\ud83c\udd95 Fail-Fast Design"}),":",(0,i.jsx)(n.br,{}),"\n","Service kills itself immediately if PostgreSQL is unavailable."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\ud83c\udd95 IP Geolocation"}),":",(0,i.jsx)(n.br,{}),"\n","Automatic region detection from IPv4/IPv6 addresses using IP-API (free) or ipapi.co (paid)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\ud83c\udd95 Neighbor Management"}),":",(0,i.jsx)(n.br,{}),"\n","Full CRUD operations for peer neighbor relationships with proper database normalization."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\ud83c\udd95 Inactive Peer Reporting"}),":",(0,i.jsx)(n.br,{}),"\n","Comprehensive system for reporting and tracking inactive peers with configurable thresholds."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\ud83c\udd95 Health Check System"}),":",(0,i.jsx)(n.br,{}),"\n","RPC-based health checks for individual peers with timeout and retry logic."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\ud83c\udd95 Time Window Filtering"}),":",(0,i.jsx)(n.br,{}),"\n","Reports filtered by configurable time windows for better accuracy and performance."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\ud83c\udd95 Buddy Management"}),":",(0,i.jsx)(n.br,{}),"\n","Recent buddy tracking with automatic limit management (39 records max) and smart cleanup."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-recent-updates",children:"\ud83d\udd04 Recent Updates"}),"\n",(0,i.jsxs)(n.h3,{id:"peer-directory-v2---normalized-data-model-v40---major-update",children:["Peer Directory v2 - Normalized Data Model (v4.0) - ",(0,i.jsx)(n.strong,{children:"MAJOR UPDATE"})]}),"\n",(0,i.jsxs)(n.p,{children:["The peer directory has been completely refactored with a ",(0,i.jsx)(n.strong,{children:"normalized data model"})," and ",(0,i.jsx)(n.strong,{children:"enhanced neighbor management capabilities"}),":"]}),"\n",(0,i.jsx)(n.h4,{id:"whats-new",children:(0,i.jsx)(n.strong,{children:"What's New:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Normalized Data Model"}),": Neighbors moved to separate ",(0,i.jsx)(n.code,{children:"peer_neighbors"})," table"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Enhanced Neighbor Management"}),": Full CRUD operations for neighbor relationships"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Inactive Peer Reporting"}),": Comprehensive system for reporting inactive neighbors"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Health Check System"}),": RPC-based health checks for individual peers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Time Window Filtering"}),": Reports filtered by configurable time windows"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Missed Heartbeat Tracking"}),": Detailed tracking of consecutive missed heartbeats"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Enhanced Registration"}),": Peers can be registered with initial neighbors"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Improved Validation"}),": Comprehensive input validation and error handling"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Database Optimization"}),": Proper indexes and constraints for performance"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"new-grpc-endpoints",children:(0,i.jsx)(n.strong,{children:"New gRPC Endpoints:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"AddNeighbor"})," - Add a neighbor relationship"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"RemoveNeighbor"})," - Remove a neighbor relationship"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GetNeighbors"})," - Get all neighbors for a peer"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ReportInactiveNeighbor"})," - Report an inactive neighbor"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GetInactiveNeighborReportsForSubject"})," - Get reports for a specific peer"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"CheckPeerHealth"})," - Perform health check on a peer"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"data-model-changes",children:(0,i.jsx)(n.strong,{children:"Data Model Changes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Before"}),": ",(0,i.jsx)(n.code,{children:"PeerRecord"})," contained ",(0,i.jsx)(n.code,{children:"neighbors"})," array field"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"After"}),": ",(0,i.jsx)(n.code,{children:"PeerRecord"})," normalized, neighbors stored in separate ",(0,i.jsx)(n.code,{children:"peer_neighbors"})," table"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Benefits"}),": Better performance, proper relationships, scalable design"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"breaking-changes",children:(0,i.jsx)(n.strong,{children:"Breaking Changes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PeerRecord"})," no longer contains ",(0,i.jsx)(n.code,{children:"neighbors"})," field"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"BatchRegister"})," RPC method removed (single-peer focus)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"RegisterPeer"}),"/",(0,i.jsx)(n.code,{children:"RegisterPeerWithAlias"})," now accept ",(0,i.jsx)(n.code,{children:"neighbors"})," parameter"]}),"\n",(0,i.jsx)(n.li,{children:"Database schema updated with new tables and indexes"}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"database-health-checks--auto-setup-v31---feature",children:["Database Health Checks & Auto-Setup (v3.1) - ",(0,i.jsx)(n.strong,{children:"FEATURE"})]}),"\n",(0,i.jsxs)(n.p,{children:["The service now includes ",(0,i.jsx)(n.strong,{children:"comprehensive database health checks and automatic setup"}),":"]}),"\n",(0,i.jsx)(n.h4,{id:"whats-new-1",children:(0,i.jsx)(n.strong,{children:"What's New:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Automatic Database Creation"}),": Service creates the ",(0,i.jsx)(n.code,{children:"jmns"})," database if it doesn't exist"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Schema Auto-Application"}),": Automatically applies SQL schema if tables are missing"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 PostgreSQL Health Checks"}),": Validates PostgreSQL connectivity before starting"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Fail-Fast Design"}),": Service kills itself immediately if PostgreSQL is unavailable"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Safe Migration"}),": Handles existing databases without breaking views or functions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Comprehensive Logging"}),": Clear status indicators and error messages"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"default-configuration",children:(0,i.jsx)(n.strong,{children:"Default Configuration:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Database"}),": ",(0,i.jsx)(n.code,{children:"jmns"})," (instead of ",(0,i.jsx)(n.code,{children:"postgres"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Schema Path"}),": ",(0,i.jsx)(n.code,{children:"sql/schema.sql"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Health Check Timeout"}),": 60 seconds"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Connection Validation"}),": 10 seconds"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"service-startup-process",children:(0,i.jsx)(n.strong,{children:"Service Startup Process:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"PostgreSQL Check"}),": Verify PostgreSQL is running and accessible"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Database Check"}),": Check if ",(0,i.jsx)(n.code,{children:"jmns"})," database exists, create if needed"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Table Check"}),": Verify required tables exist, apply schema if needed"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Service Creation"}),": Initialize GORM JMNS service"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Final Validation"}),": Perform comprehensive database validation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Server Start"}),": Launch gRPC server only if everything is ready"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"error-handling",children:(0,i.jsx)(n.strong,{children:"Error Handling:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"PostgreSQL Not Running"}),": Service fails immediately with clear error"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Permission Issues"}),": Detailed error messages with remediation hints"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Schema Conflicts"}),": Safe handling of existing views and functions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Connection Timeouts"}),": Proper timeout handling with retry logic"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"gorm-migration-v30---major-update",children:["GORM Migration (v3.0) - ",(0,i.jsx)(n.strong,{children:"MAJOR UPDATE"})]}),"\n",(0,i.jsxs)(n.p,{children:["The peer directory has been ",(0,i.jsx)(n.strong,{children:"completely migrated from direct PostgreSQL connections to GORM ORM"}),":"]}),"\n",(0,i.jsx)(n.h4,{id:"what-changed",children:(0,i.jsx)(n.strong,{children:"What Changed:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 ORM Integration"}),": Replaced raw SQL with GORM for type-safe database operations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Automatic Migrations"}),": GORM AutoMigrate handles schema creation and updates"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Type Safety"}),": Compile-time validation for all database operations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Better Error Handling"}),": Clear, actionable error messages"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Maintainable Code"}),": Clean repository pattern with separation of concerns"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 JSON Support"}),": Proper JSONB handling for labels and metadata"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Array Support"}),": PostgreSQL array types working seamlessly"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Foreign Keys"}),": Proper relationship management between tables"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"technical-improvements",children:(0,i.jsx)(n.strong,{children:"Technical Improvements:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Database Layer"}),": ",(0,i.jsx)(n.code,{children:"pkg/peer/gorm_repository.go"})," - New GORM-based repository"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Models"}),": ",(0,i.jsx)(n.code,{children:"pkg/peer/models.go"})," - GORM models with proper tags and relationships"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Services"}),": ",(0,i.jsx)(n.code,{children:"pkg/peer/gorm_jmns_service.go"})," - GORM-integrated service layer"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Geolocation"}),": ",(0,i.jsx)(n.code,{children:"pkg/peer/geolocation_*.go"})," - IP geolocation with multiple service providers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Dependencies"}),": Added ",(0,i.jsx)(n.code,{children:"gorm.io/gorm"}),", ",(0,i.jsx)(n.code,{children:"gorm.io/driver/postgres"}),", ",(0,i.jsx)(n.code,{children:"gorm.io/datatypes"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Migration"}),": Automatic schema creation with proper dependency order"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"performance-benefits",children:(0,i.jsx)(n.strong,{children:"Performance Benefits:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Faster Development"}),": No more manual SQL writing and result scanning"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type Safety"}),": Compile-time validation prevents runtime errors"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Better Maintainability"}),": Clean, readable code with clear separation of concerns"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Automatic Mapping"}),": No manual data conversion between Go structs and database rows"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Query Optimization"}),": GORM handles query optimization and connection pooling"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"backward-compatibility",children:(0,i.jsx)(n.strong,{children:"Backward Compatibility:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 API Unchanged"}),": All gRPC endpoints remain the same"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Data Preserved"}),": Existing data is automatically migrated"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Same Performance"}),": No performance degradation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Enhanced Reliability"}),": Better error handling and type safety"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"binary-status-system-v20",children:"Binary Status System (v2.0)"}),"\n",(0,i.jsxs)(n.p,{children:["The peer directory uses a ",(0,i.jsx)(n.strong,{children:"simplified binary status system"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Active (1)"}),": Peer is online and responding"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u274c Inactive (0)"}),": Peer is offline or unresponsive"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Cleaner UI with green/red status indicators"}),"\n",(0,i.jsx)(n.li,{children:"Simplified database storage (integer instead of string enums)"}),"\n",(0,i.jsx)(n.li,{children:"Better performance and reduced complexity"}),"\n",(0,i.jsx)(n.li,{children:"Clear visual distinction between peer states"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"-ip-geolocation-v32---new-feature",children:["\ud83c\udf0d IP Geolocation (v3.2) - ",(0,i.jsx)(n.strong,{children:"NEW FEATURE"})]}),"\n",(0,i.jsxs)(n.p,{children:["The peer directory now includes ",(0,i.jsx)(n.strong,{children:"automatic IP geolocation"})," to identify regions from peer IP addresses:"]}),"\n",(0,i.jsx)(n.h3,{id:"whats-new-2",children:(0,i.jsx)(n.strong,{children:"What's New:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Automatic Region Detection"}),": Detects region from IPv4/IPv6 addresses during peer registration"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 IP-API Integration"}),": Uses IP-API service by default (free, no API key required)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 ipapi.co Support"}),": Optional paid service for higher rate limits"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Fallback Strategy"}),': IP-API \u2192 Basic mapping \u2192 "unknown"']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Non-Intrusive"}),": Only adds region if not already present in labels"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Preserves Existing Data"}),": Won't overwrite existing region labels"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 IPv4 & IPv6 Support"}),": Handles both address types from multiaddrs"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"supported-services",children:(0,i.jsx)(n.strong,{children:"Supported Services:"})}),"\n",(0,i.jsxs)(n.h4,{id:"ip-api-default---free",children:[(0,i.jsx)(n.strong,{children:"IP-API"})," (Default - Free)"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Speed"}),": ~100-500ms per lookup"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Accuracy"}),": Good"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cost"}),": Free (45 requests/minute)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Network"}),": Requires internet"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Setup"}),": No API key required"]}),"\n"]}),"\n",(0,i.jsxs)(n.h4,{id:"ipapico-optional---paid",children:[(0,i.jsx)(n.strong,{children:"ipapi.co"})," (Optional - Paid)"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Speed"}),": ~100-300ms per lookup"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Accuracy"}),": Very good"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cost"}),": $10/month (1,000 requests)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Network"}),": Requires internet"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Setup"}),": Requires API key"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"configuration",children:(0,i.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,i.jsx)(n.h4,{id:"environment-variables",children:(0,i.jsx)(n.strong,{children:"Environment Variables:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Choose your provider (optional - defaults to ip-api)\nexport GEO_PROVIDER="ip-api"  # Only IP-API is supported\n\n# API key (if using ipapi.co)\nexport IPAPI_CO_KEY="your_key"\n'})}),"\n",(0,i.jsx)(n.h4,{id:"programmatic-configuration",children:(0,i.jsx)(n.strong,{children:"Programmatic Configuration:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'import "seedNodes/pkg/peer"\n\n// Option 1: Use IP-API (default, free)\nconfig := peer.GeoLocationConfig{\n    Provider: "ip-api",\n}\n\n// Option 2: Use ipapi.co (paid, requires API key)\nconfig := peer.GeoLocationConfig{\n    Provider: "ip-api",\n    APIKey:   "your_api_key",\n}\n\n// Option 3: Use basic mapping (no internet required)\nconfig := peer.GeoLocationConfig{\n    Provider: "basic",\n}\n\ngeoService, err := peer.NewGeoLocationServiceFromConfig(config)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"region-format",children:(0,i.jsx)(n.strong,{children:"Region Format:"})}),"\n",(0,i.jsxs)(n.p,{children:["The system returns regions in the format: ",(0,i.jsx)(n.code,{children:"COUNTRY-REGION-CITY"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Examples:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"US-VA-Ashburn"})," (United States, Virginia, Ashburn)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DE-BW-Berlin"})," (Germany, Baden-W\xfcrttemberg, Berlin)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"JP-13-Tokyo"})," (Japan, Tokyo, Tokyo)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GB-ENG-London"})," (United Kingdom, England, London)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"automatic-integration",children:(0,i.jsx)(n.strong,{children:"Automatic Integration:"})}),"\n",(0,i.jsx)(n.p,{children:"Region detection happens automatically during peer registration:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'// This will automatically detect and add region information\nrecord := &peer.SignedPeerRecord{\n    PeerID:     "12D3KooW...",\n    Multiaddrs: []string{"/ip4/8.8.8.8/tcp/4001/p2p/12D3KooW..."},\n    Labels:     map[string]string{}, // Region will be added automatically\n}\n\nerr := jmnsService.RegisterPeer(ctx, record)\n// record.Labels will now contain region information\n'})}),"\n",(0,i.jsx)(n.h3,{id:"database-storage",children:(0,i.jsx)(n.strong,{children:"Database Storage:"})}),"\n",(0,i.jsxs)(n.p,{children:["Region information is stored in the existing ",(0,i.jsx)(n.code,{children:"labels"})," JSONB field:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "region": "US-VA-Ashburn",\n  "region_detected_at": "1703123456",\n  "role": "validator"\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"setup-guide",children:(0,i.jsx)(n.strong,{children:"Setup Guide:"})}),"\n",(0,i.jsxs)(n.p,{children:["For detailed setup instructions, see ",(0,i.jsx)(n.a,{href:"GEOLOCATION_SETUP.md",children:"GEOLOCATION_SETUP.md"})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"\ufe0f-peer-weights-system-v33---new-feature",children:["\u2696\ufe0f Peer Weights System (v3.3) - ",(0,i.jsx)(n.strong,{children:"NEW FEATURE"})]}),"\n",(0,i.jsxs)(n.p,{children:["The peer directory now supports ",(0,i.jsx)(n.strong,{children:"peer weights"})," for priority-based routing and load balancing:"]}),"\n",(0,i.jsx)(n.h3,{id:"whats-new-3",children:(0,i.jsx)(n.strong,{children:"What's New:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Weight Assignment"}),": Peers can be assigned numerical weights (0.0-1.0)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 UpdatePeerWeights API"}),": New gRPC method to update peer weights"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Database Storage"}),": Weights stored as REAL type in PostgreSQL"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Signature Verification"}),": Weight updates require cryptographic signatures"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Sequence Management"}),": Proper sequence number handling for updates"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Type Safety"}),": Full type safety with float64 in Go, float in protobuf"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"use-cases",children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Load Balancing"}),": Higher weights indicate more capable peers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Priority Routing"}),": Prefer peers with higher weights for operations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Resource Allocation"}),": Weights represent computational power or bandwidth"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Consensus Participation"}),": Influence voting power in consensus mechanisms"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"api-usage",children:(0,i.jsx)(n.strong,{children:"API Usage:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Update peer weights via gRPC\ngrpcurl -plaintext -d \'{\n  "peerId": "12D3KooWTestPeer123456789",\n  "weights": 0.95,\n  "v": "0x1c",\n  "r": "0x1234567890abcdef...",\n  "s": "0x1234567890abcdef..."\n}\' localhost:17002 peerpb.PeerDirectory/UpdatePeerWeights\n'})}),"\n",(0,i.jsx)(n.h3,{id:"weight-values",children:(0,i.jsx)(n.strong,{children:"Weight Values:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Range"}),": 0.0 to 1.0 (recommended)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Default"}),": 0.0 (no special weight)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Examples"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"0.0"})," - Standard peer"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"0.5"})," - Medium priority"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"0.85"})," - High priority"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"1.0"})," - Maximum priority"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"-buddy-management-v41---new-feature",children:["\ud83d\udc65 Buddy Management (v4.1) - ",(0,i.jsx)(n.strong,{children:"NEW FEATURE"})]}),"\n",(0,i.jsxs)(n.p,{children:["The peer directory now includes ",(0,i.jsx)(n.strong,{children:"buddy management"})," functionality to maintain a list of recently interacted peers:"]}),"\n",(0,i.jsx)(n.h3,{id:"whats-new-4",children:(0,i.jsx)(n.strong,{children:"What's New:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Recent Buddy Tracking"}),": Maintains a list of recently interacted peers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Automatic Limit Management"}),": Automatically maintains a maximum of 39 records"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Smart Cleanup"}),": Removes oldest 13 records when limit is exceeded"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Exclusion Filtering"}),": ListBuddy returns all peers except recent buddies"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Transaction Safety"}),": All operations are wrapped in database transactions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Non-Existent Peer Handling"}),": Skips peers that don't exist in the system"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"how-it-works",children:(0,i.jsx)(n.strong,{children:"How It Works:"})}),"\n",(0,i.jsx)(n.h4,{id:"updatebuddy",children:(0,i.jsx)(n.strong,{children:"UpdateBuddy"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Adds new peer IDs to the recent buddy list"}),"\n",(0,i.jsx)(n.li,{children:"Automatically maintains the 39-record limit"}),"\n",(0,i.jsx)(n.li,{children:"Updates timestamps for existing buddies"}),"\n",(0,i.jsx)(n.li,{children:"Returns count of added and removed records"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"listbuddy",children:(0,i.jsx)(n.strong,{children:"ListBuddy"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Returns all peers in the system"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Excludes"})," peers that are in the recent buddy list"]}),"\n",(0,i.jsx)(n.li,{children:"Useful for finding new peers to interact with"}),"\n",(0,i.jsx)(n.li,{children:"Maintains full peer record information"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"database-schema",children:(0,i.jsx)(n.strong,{children:"Database Schema:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Recent buddy table (max 39 records, oldest 13 removed when limit reached)\nCREATE TABLE recent_buddy (\n    id SERIAL PRIMARY KEY,\n    peer_id VARCHAR(255) NOT NULL REFERENCES peer_records(peer_id) ON DELETE CASCADE,\n    added_at BIGINT NOT NULL DEFAULT EXTRACT(EPOCH FROM NOW()),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    UNIQUE(peer_id)\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"use-cases-1",children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Peer Discovery"}),": Find new peers to connect to (exclude recent buddies)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Load Distribution"}),": Avoid repeatedly connecting to the same peers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Network Expansion"}),": Discover fresh peers for better network coverage"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Connection Management"}),": Track recently used connections for optimization"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"api-usage-1",children:(0,i.jsx)(n.strong,{children:"API Usage:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Update recent buddy list\ngrpcurl -plaintext -d \'{\n  "peer_ids": ["12D3KooWTestPeer123456789", "12D3KooWAnotherPeer987654321"]\n}\' localhost:17002 peerpb.PeerDirectory/UpdateBuddy\n\n# List peers excluding recent buddies\ngrpcurl -plaintext -d \'{}\' localhost:17002 peerpb.PeerDirectory/ListBuddy\n'})}),"\n",(0,i.jsx)(n.h3,{id:"response-examples",children:(0,i.jsx)(n.strong,{children:"Response Examples:"})}),"\n",(0,i.jsx)(n.h4,{id:"updatebuddy-response",children:(0,i.jsx)(n.strong,{children:"UpdateBuddy Response:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "accepted": true,\n  "message": "Successfully updated buddy list. Added: 2, Removed: 0",\n  "addedCount": 2,\n  "removedCount": 0\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"listbuddy-response",children:(0,i.jsx)(n.strong,{children:"ListBuddy Response:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "peers": [\n    {\n      "peerId": "12D3KooWNewPeer123456789",\n      "multiaddrs": ["/ip4/127.0.0.1/tcp/4001/p2p/12D3KooWNewPeer123456789"],\n      "currentStatus": "PEER_STATUS_ACTIVE",\n      "weights": 0.5,\n      "labels": {"role": "validator", "region": "US-CA"}\n    }\n  ],\n  "totalCount": 1\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"automatic-limit-management",children:(0,i.jsx)(n.strong,{children:"Automatic Limit Management:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Maximum Records"}),": 39 peers in recent buddy list"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cleanup Trigger"}),": Every UpdateBuddy call"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cleanup Amount"}),": Removes oldest 13 records when limit exceeded"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Database Function"}),": ",(0,i.jsx)(n.code,{children:"maintain_recent_buddy_limit()"})," handles cleanup automatically"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-gorm-architecture",children:"\ud83c\udfd7\ufe0f GORM Architecture"}),"\n",(0,i.jsx)(n.h3,{id:"database-layer-structure",children:"Database Layer Structure"}),"\n",(0,i.jsx)(n.p,{children:"The system now uses a clean GORM-based architecture:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"pkg/peer/\n\u251c\u2500\u2500 models.go              # GORM models with proper tags\n\u251c\u2500\u2500 gorm_repository.go     # GORM repository implementation\n\u251c\u2500\u2500 gorm_jmns_service.go   # GORM-integrated service layer\n\u251c\u2500\u2500 gorm_db.go            # Database connection utilities\n\u251c\u2500\u2500 types.go              # Internal type definitions\n\u251c\u2500\u2500 geolocation.go        # Basic geolocation service with lookup tables\n\u251c\u2500\u2500 geolocation_api.go    # HTTP API services (IP-API, ipapi.co, IPStack)\n\u251c\u2500\u2500 geolocation_config.go # Configuration management for geolocation\n\u2514\u2500\u2500 geolocation_test.go   # Unit tests for geolocation functionality\n"})}),"\n",(0,i.jsx)(n.h3,{id:"gorm-models",children:"GORM Models"}),"\n",(0,i.jsx)(n.h4,{id:"peerrecord",children:"PeerRecord"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'type PeerRecord struct {\n    PeerID        string         `gorm:"primaryKey;column:peer_id;type:varchar(255)"`\n    Multiaddrs    pq.StringArray `gorm:"type:text[];not null"`\n    Seq           uint64         `gorm:"not null;default:1"`\n    FirstCreated  int64          `gorm:"not null"`\n    LastUpdated   int64          `gorm:"not null"`\n    ActiveFrom    int64          `gorm:"not null"`\n    CurrentStatus int            `gorm:"not null;default:1"`\n    Neighbors     pq.StringArray `gorm:"type:text[];default:\'{}\'"`\n    Labels        datatypes.JSON `gorm:"type:jsonb;default:\'{}\'"`\n    Weights       float64        `gorm:"type:real;default:0.0"`\n    V             string         `gorm:"not null"`\n    R             string         `gorm:"not null"`\n    S             string         `gorm:"not null"`\n    CreatedAt     time.Time      `gorm:"autoCreateTime"`\n    UpdatedAt     time.Time      `gorm:"autoUpdateTime"`\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"gormpeeralias",children:"GormPeerAlias"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'type GormPeerAlias struct {\n    Name        string    `gorm:"primaryKey;column:name;type:varchar(255)"`\n    PeerID      string    `gorm:"not null;column:peer_id;type:varchar(255)"`\n    Created     int64     `gorm:"not null"`\n    LastUpdated int64     `gorm:"not null"`\n    V           string    `gorm:"not null"`\n    R           string    `gorm:"not null"`\n    S           string    `gorm:"not null"`\n    CreatedAt   time.Time `gorm:"autoCreateTime"`\n    UpdatedAt   time.Time `gorm:"autoUpdateTime"`\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"heartbeat",children:"Heartbeat"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'type Heartbeat struct {\n    ID         uint64         `gorm:"primaryKey;autoIncrement"`\n    PeerID     string         `gorm:"not null;column:peer_id;type:varchar(255)"`\n    Timestamp  int64          `gorm:"not null"`\n    Status     int64          `gorm:"not null"`\n    Multiaddrs pq.StringArray `gorm:"type:text[]"`\n    V          string         `gorm:"not null"`\n    R          string         `gorm:"not null"`\n    S          string         `gorm:"not null"`\n    CreatedAt  time.Time      `gorm:"autoCreateTime"`\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"key-gorm-features",children:"Key GORM Features"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"AutoMigrate"}),": Automatic schema creation and updates"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type Safety"}),": Compile-time validation for all operations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"JSON Support"}),": Native JSONB handling with ",(0,i.jsx)(n.code,{children:"datatypes.JSON"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Array Support"}),": PostgreSQL arrays with ",(0,i.jsx)(n.code,{children:"pq.StringArray"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Timestamps"}),": Automatic ",(0,i.jsx)(n.code,{children:"CreatedAt"})," and ",(0,i.jsx)(n.code,{children:"UpdatedAt"})," management"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Foreign Keys"}),": Proper relationship constraints"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Connection Pooling"}),": Efficient database connection management"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"database-schema-1",children:"Database Schema"}),"\n",(0,i.jsx)(n.p,{children:"The system uses PostgreSQL with the following key tables:"}),"\n",(0,i.jsx)(n.h4,{id:"peer_records",children:"peer_records"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE peer_records (\n    peer_id VARCHAR(255) PRIMARY KEY,\n    multiaddrs TEXT[] NOT NULL,\n    seq BIGINT NOT NULL DEFAULT 1,\n    first_created BIGINT NOT NULL,\n    last_updated BIGINT NOT NULL,\n    active_from BIGINT NOT NULL,\n    current_status INTEGER NOT NULL DEFAULT 1,\n    neighbors TEXT[] DEFAULT '{}',\n    labels JSONB DEFAULT '{}',\n    weights REAL DEFAULT 0.0,           -- NEW: Peer weight field\n    v TEXT NOT NULL,\n    r TEXT NOT NULL,\n    s TEXT NOT NULL,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Key Fields"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"weights"}),": Float value (0.0-1.0) representing peer priority/weight"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"labels"}),": JSONB field for metadata (region, role, etc.)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"neighbors"}),": Array of connected peer IDs"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"current_status"}),": Binary status (1=active, 0=inactive)"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"-data-models",children:"\ud83d\udce6 Data Models"}),"\n",(0,i.jsx)(n.h3,{id:"signed-peer-record-v3-gorm",children:"Signed Peer Record v3 (GORM)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "peer_id": "12D3KooW...",\n  "multiaddrs": ["/ip4/1.2.3.4/tcp/4001/p2p/12D3KooW..."],\n  "seq": 42,\n  "first_created": 1735689600,\n  "last_updated": 1735689600,\n  "active_from": 1735689600,\n  "current_status": "PEER_STATUS_ACTIVE",\n  "neighbors": ["12D3KooX...", "12D3KooY..."],\n  "labels": {"role": "fullnode", "region": "apac"},\n  "weights": 0.85,\n  "v": "0x00",\n  "r": "0x1234567890abcdef...",\n  "s": "0xabcdef1234567890..."\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h1,{id:"seednodes",children:"seedNodes"}),"\n",(0,i.jsx)(n.h2,{id:"one-shot-dependency-install",children:"One-shot Dependency Install"}),"\n",(0,i.jsx)(n.p,{children:"Run this once to install protoc plugins, download Go deps, and generate stubs:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"cd seedNodes\n./scripts/install_deps.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:"This performs:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Installs ",(0,i.jsx)(n.code,{children:"protoc-gen-go"})," and ",(0,i.jsx)(n.code,{children:"protoc-gen-go-grpc"})]}),"\n",(0,i.jsxs)(n.li,{children:["Runs ",(0,i.jsx)(n.code,{children:"go mod tidy"})," + ",(0,i.jsx)(n.code,{children:"go mod download"})]}),"\n",(0,i.jsxs)(n.li,{children:["Generates gRPC code from ",(0,i.jsx)(n.code,{children:"api/proto/redis_streams.proto"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"build-binaries",children:"Build Binaries"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"go build ./cmd/pg-cud-consumer\ngo build ./cmd/hrw-exporter\ngo build ./cmd/seednode-grpc\ngo build ./cmd/jmns-service\n"})}),"\n",(0,i.jsx)(n.h2,{id:"run",children:"Run"}),"\n",(0,i.jsxs)(n.p,{children:["Ensure the Redis Streams gRPC microservice is running (",(0,i.jsx)(n.code,{children:"../Redis-Streams/./RDS.sh run-microservice"}),") and Postgres is reachable."]}),"\n",(0,i.jsx)(n.p,{children:"Example env and run commands:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# CUD Consumer (applies to Postgres)\nPG_DSN=postgres://postgres:postgres@localhost:5432/postgres?sslmode=disable \\\nRS_ADDR=0.0.0.0:16001 \\\nRS_TOPIC_CUD=seednode.cud \\\nRS_CONSUMER_GROUP=seednode-cud-group \\\nRS_CONSUMER_NAME=seednode-cud-consumer-1 \\\n./pg-cud-consumer\n\n# Exporter (publishes table pages)\nPG_DSN=postgres://postgres:postgres@localhost:5432/postgres?sslmode=disable \\\nRS_ADDR=0.0.0.0:16001 \\\nRS_TOPIC_READ=seednode.read \\\n./hrw-exporter\n\n## SeedNode gRPC Orchestrator\n\nStart the SeedNode gRPC server (publishes CUD to Redis Streams and serves reads from Postgres):\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["PG_DSN=postgres://postgres",":postgres","@localhost:5432/postgres?sslmode=disable ",(0,i.jsx)(n.br,{}),"\n","RS_ADDR=0.0.0.0:16001 ",(0,i.jsx)(n.br,{}),"\n","RS_TOPIC_CUD=seednode.cud ",(0,i.jsx)(n.br,{}),"\n","./seednode-grpc --port 17001"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'\nTest with grpcurl (install via `brew install grpcurl` on macOS):\n\n#### BatchUpsert (queues to Redis Streams; processed by the pg-cud-consumer)\n\n```bash\ngrpcurl -plaintext -d \'{\n  "items": [{\n    "tx_hash": "0xtest001",\n    "epoch": 123,\n    "primary_shard_id": 5,\n    "replica_shard_ids": [6,7],\n    "routing_engine_id": "local-dev-1"\n  }]\n}\' localhost:17001 seednodepb.SeedNode/BatchUpsert\n'})}),"\n",(0,i.jsx)(n.h4,{id:"batchdelete",children:"BatchDelete"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'grpcurl -plaintext -d \'{"tx_hashes":["0xtest001"]}\' localhost:17001 seednodepb.SeedNode/BatchDelete\n'})}),"\n",(0,i.jsx)(n.h4,{id:"get-reads-directly-from-postgres",children:"Get (reads directly from Postgres)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'grpcurl -plaintext -d \'{"tx_hash":"0xtest001"}\' localhost:17001 seednodepb.SeedNode/Get\n'})}),"\n",(0,i.jsx)(n.h4,{id:"list-keyset-pagination",children:"List (keyset pagination)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'grpcurl -plaintext -d \'{"after_tx_hash":"","limit":10}\' localhost:17001 seednodepb.SeedNode/List\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Note: Keep ",(0,i.jsx)(n.code,{children:"pg-cud-consumer"})," running to apply CUD messages to Postgres."]}),"\n",(0,i.jsx)(n.h2,{id:"peer-directory-service-jmns",children:"Peer Directory Service (JMNS)"}),"\n",(0,i.jsx)(n.h3,{id:"option-1-using-docker-postgresql",children:"Option 1: Using Docker PostgreSQL"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Start PostgreSQL (using Docker)\ndocker run --name postgres-jmns -e POSTGRES_PASSWORD=postgres -e POSTGRES_DB=postgres -p 5432:5432 -d postgres:15\n\n# Create database schema\ndocker exec -i postgres-jmns psql -U postgres -d postgres < sql/schema.sql\n\n# Start the peer directory service\nPG_DSN="postgres://postgres:postgres@localhost:5432/postgres?sslmode=disable" ./jmns-service --port 17002\n'})}),"\n",(0,i.jsx)(n.h3,{id:"option-2-using-native-postgresql-ubuntudebian",children:"Option 2: Using Native PostgreSQL (Ubuntu/Debian)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Quick Setup (Recommended):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Run the automated setup script\n./scripts/setup_postgres_ubuntu.sh\n\n# Start the peer directory service\nPG_DSN="postgres://postgres:postgres@localhost:5432/postgres?sslmode=disable" ./jmns-service --port 17002\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Manual Setup:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Install PostgreSQL\nsudo apt update\nsudo apt install postgresql postgresql-contrib\n\n# Start PostgreSQL service\nsudo systemctl start postgresql\nsudo systemctl enable postgresql\n\n# Create database and user\nsudo -u postgres psql -c "CREATE DATABASE postgres;"\nsudo -u postgres psql -c "CREATE USER postgres WITH PASSWORD \'postgres\';"\nsudo -u postgres psql -c "GRANT ALL PRIVILEGES ON DATABASE postgres TO postgres;"\n\n# Create database schema\npsql -h localhost -U postgres -d postgres < sql/schema.sql\n\n# Start the peer directory service\nPG_DSN="postgres://postgres:postgres@localhost:5432/postgres?sslmode=disable" ./jmns-service --port 17002\n'})}),"\n",(0,i.jsx)(n.h3,{id:"testing",children:"Testing"}),"\n",(0,i.jsx)(n.p,{children:"Test the peer directory service:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Run the comprehensive test suite\n./test/test_jmns_service.sh\n\n# Run other tests\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-web-ui",children:"\ud83c\udf10 Web UI"}),"\n",(0,i.jsx)(n.p,{children:"The peer directory includes a modern web interface for viewing and managing peers."}),"\n",(0,i.jsx)(n.h3,{id:"start-the-web-ui",children:"Start the Web UI"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Build the peer UI service\ngo build -o bin/peer-ui cmd/peer-ui/main.go\n\n# Start the web UI (requires JMNS service running on port 17002)\n./bin/peer-ui\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The web UI will be available at: ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"http://localhost:8080",children:"http://localhost:8080"})})]}),"\n",(0,i.jsx)(n.h3,{id:"features",children:"Features"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\ud83d\udcca Dashboard"}),": View peer statistics and status overview"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\ud83d\udd0d Peer Browser"}),": Browse all registered peers with filtering"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\ud83d\udcc8 Real-time Status"}),": Live updates of peer status (active/inactive)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\ud83c\udfa8 Simple UI"}),": Clean, responsive interface with status indicators"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\ud83d\udd0e Search & Filter"}),": Filter peers by status, labels, and more"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"api-endpoints",children:"API Endpoints"}),"\n",(0,i.jsx)(n.p,{children:"The web UI exposes REST API endpoints:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GET /api/peers"})," - List all peers with optional filtering"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GET /api/peers/{peer_id}"})," - Get specific peer details"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GET /api/peers/by-alias/{alias}"})," - Get peer by alias"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example API usage:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# List all peers\ncurl http://localhost:8080/api/peers\n\n# Filter by status\ncurl "http://localhost:8080/api/peers?status=active"\n\n# Get specific peer\ncurl http://localhost:8080/api/peers/12D3KooWTestPeer123456789\n'})}),"\n",(0,i.jsx)(n.h2,{id:"-grpc-api-reference",children:"\ud83d\udd0c gRPC API Reference"}),"\n",(0,i.jsx)(n.p,{children:"The peer directory service exposes the following gRPC endpoints:"}),"\n",(0,i.jsx)(n.h3,{id:"core-operations",children:"Core Operations"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Method"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Request"}),(0,i.jsx)(n.th,{children:"Response"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RegisterPeer"})}),(0,i.jsx)(n.td,{children:"Register a new peer"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RegisterPeerRequest"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RegisterPeerResponse"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RegisterPeerWithAlias"})}),(0,i.jsx)(n.td,{children:"Register peer with alias in one operation"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RegisterPeerWithAliasRequest"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RegisterPeerWithAliasResponse"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"UpdatePeer"})}),(0,i.jsx)(n.td,{children:"Update existing peer"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"UpdatePeerRequest"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"UpdatePeerResponse"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"UpdatePeerWeights"})}),(0,i.jsx)(n.td,{children:"Update peer weights"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"UpdatePeerWeightsRequest"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"UpdatePeerWeightsResponse"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"GetPeer"})}),(0,i.jsx)(n.td,{children:"Get peer by ID"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"GetPeerRequest"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"GetPeerResponse"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DeletePeer"})}),(0,i.jsx)(n.td,{children:"Delete peer"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DeletePeerRequest"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DeletePeerResponse"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ListPeers"})}),(0,i.jsx)(n.td,{children:"List peers with filtering"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PeerListRequest"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PeerListResponse"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"alias-operations",children:"Alias Operations"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Method"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Request"}),(0,i.jsx)(n.th,{children:"Response"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CreateAlias"})}),(0,i.jsx)(n.td,{children:"Create peer alias"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CreateAliasRequest"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CreateAliasResponse"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"GetPeerByAlias"})}),(0,i.jsx)(n.td,{children:"Get peer by alias"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"GetPeerByAliasRequest"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"GetPeerByAliasResponse"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DeleteAlias"})}),(0,i.jsx)(n.td,{children:"Delete alias"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DeleteAliasRequest"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DeleteAliasResponse"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"neighbor-management-new",children:"Neighbor Management (NEW)"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Method"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Request"}),(0,i.jsx)(n.th,{children:"Response"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"AddNeighbor"})}),(0,i.jsx)(n.td,{children:"Add a neighbor relationship"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"AddNeighborRequest"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"AddNeighborResponse"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RemoveNeighbor"})}),(0,i.jsx)(n.td,{children:"Remove a neighbor relationship"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RemoveNeighborRequest"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RemoveNeighborResponse"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"GetNeighbors"})}),(0,i.jsx)(n.td,{children:"Get all neighbors for a peer"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"GetNeighborsRequest"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"GetNeighborsResponse"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"inactive-peer-reporting-new",children:"Inactive Peer Reporting (NEW)"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Method"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Request"}),(0,i.jsx)(n.th,{children:"Response"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ReportInactiveNeighbor"})}),(0,i.jsx)(n.td,{children:"Report an inactive neighbor"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ReportInactiveNeighborRequest"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ReportInactiveNeighborResponse"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"GetInactiveNeighborReportsForSubject"})}),(0,i.jsx)(n.td,{children:"Get reports for a specific peer"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"GetInactiveNeighborReportsForSubjectRequest"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"GetInactiveNeighborReportsForSubjectResponse"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"health-checks-new",children:"Health Checks (NEW)"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Method"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Request"}),(0,i.jsx)(n.th,{children:"Response"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CheckPeerHealth"})}),(0,i.jsx)(n.td,{children:"Perform health check on a peer"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"HealthCheckRequest"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"HealthCheckResponse"})})]})})]}),"\n",(0,i.jsx)(n.h3,{id:"heartbeat--service-operations",children:"Heartbeat & Service Operations"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Method"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Request"}),(0,i.jsx)(n.th,{children:"Response"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SendHeartbeat"})}),(0,i.jsx)(n.td,{children:"Send peer heartbeat"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SendHeartbeatRequest"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SendHeartbeatResponse"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"HealthCheck"})}),(0,i.jsx)(n.td,{children:"Service health check"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Empty"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Empty"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"status-values",children:"Status Values"}),"\n",(0,i.jsxs)(n.p,{children:["The system uses a ",(0,i.jsx)(n.strong,{children:"binary status system"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PEER_STATUS_ACTIVE"})," (1) - Peer is online and active"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PEER_STATUS_INACTIVE"})," (0) - Peer is offline or inactive"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"weights-system",children:"Weights System"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.strong,{children:"weights field"})," allows peers to be assigned numerical weights for various purposes:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Load Balancing"}),": Higher weights can indicate more capable peers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Priority Routing"}),": Peers with higher weights may be preferred for certain operations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Resource Allocation"}),": Weights can represent computational power, bandwidth, or reliability"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Consensus Participation"}),": Weights can influence voting power in consensus mechanisms"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Weight Values"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Range: ",(0,i.jsx)(n.code,{children:"0.0"})," to ",(0,i.jsx)(n.code,{children:"1.0"})," (recommended)"]}),"\n",(0,i.jsxs)(n.li,{children:["Default: ",(0,i.jsx)(n.code,{children:"0.0"})," (no special weight)"]}),"\n",(0,i.jsxs)(n.li,{children:["Type: ",(0,i.jsx)(n.code,{children:"float64"})," in Go, ",(0,i.jsx)(n.code,{children:"float"})," in protobuf, ",(0,i.jsx)(n.code,{children:"REAL"})," in PostgreSQL"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Usage Examples"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"0.0"})," - Standard peer with no special weight"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"0.5"})," - Medium priority peer"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"0.85"})," - High priority peer"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"1.0"})," - Maximum priority peer"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"example-grpc-calls",children:"Example gRPC Calls"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# List all peers\ngrpcurl -plaintext -d \'{}\' localhost:17002 peerpb.PeerDirectory/ListPeers\n\n# Register a new peer with neighbors (NEW)\ngrpcurl -plaintext -d \'{\n  "peerRecord": {\n    "peerId": "12D3KooWTestPeer123456789",\n    "multiaddrs": ["/ip4/127.0.0.1/tcp/4001/p2p/12D3KooWTestPeer123456789"],\n    "seq": 1,\n    "currentStatus": "PEER_STATUS_ACTIVE",\n    "labels": {"region": "local", "role": "testnode"},\n    "v": "0x00",\n    "r": "0x1234567890abcdef...",\n    "s": "0xabcdef1234567890..."\n  },\n  "neighbors": ["12D3KooWNeighbor1", "12D3KooWNeighbor2"]\n}\' localhost:17002 peerpb.PeerDirectory/RegisterPeer\n\n# Add a neighbor (NEW)\ngrpcurl -plaintext -d \'{\n  "peerId": "12D3KooWTestPeer123456789",\n  "neighborId": "12D3KooWNewNeighbor",\n  "v": "0x00",\n  "r": "0x1111111111111111...",\n  "s": "0x2222222222222222..."\n}\' localhost:17002 peerpb.PeerDirectory/AddNeighbor\n\n# Get neighbors for a peer (NEW)\ngrpcurl -plaintext -d \'{\n  "peerId": "12D3KooWTestPeer123456789"\n}\' localhost:17002 peerpb.PeerDirectory/GetNeighbors\n\n# Report inactive neighbor (NEW)\ngrpcurl -plaintext -d \'{\n  "report": {\n    "reporterPeerId": "12D3KooWReporterPeer",\n    "subjectPeerId": "12D3KooWTestPeer123456789",\n    "lastSeenTimestamp": 1735689600,\n    "reason": "missed_heartbeats",\n    "reportedAt": 1735689700,\n    "missedHeartbeatCount": 3,\n    "v": "0x00",\n    "r": "0x5555555555555555...",\n    "s": "0x6666666666666666..."\n  }\n}\' localhost:17002 peerpb.PeerDirectory/ReportInactiveNeighbor\n\n# Check peer health (NEW)\ngrpcurl -plaintext -d \'{\n  "peerId": "12D3KooWTestPeer123456789"\n}\' localhost:17002 peerpb.PeerDirectory/CheckPeerHealth\n\n# Register a peer with alias in one operation\ngrpcurl -plaintext -d \'{\n  "peerRecord": {\n    "peerId": "12D3KooWTestPeer123456789",\n    "multiaddrs": ["/ip4/127.0.0.1/tcp/4001/p2p/12D3KooWTestPeer123456789"],\n    "seq": 1,\n    "currentStatus": "PEER_STATUS_ACTIVE",\n    "labels": {"region": "local", "role": "testnode"},\n    "v": "0x00",\n    "r": "0x1234567890abcdef...",\n    "s": "0xabcdef1234567890..."\n  },\n  "alias": {\n    "name": "alice.node.jmdt",\n    "peerId": "12D3KooWTestPeer123456789",\n    "v": "0x00",\n    "r": "0x9876543210fedcba...",\n    "s": "0xfedcba9876543210..."\n  }\n}\' localhost:17002 peerpb.PeerDirectory/RegisterPeerWithAlias\n\n# Get peer by ID\ngrpcurl -plaintext -d \'{"peerId": "12D3KooWTestPeer123456789"}\' localhost:17002 peerpb.PeerDirectory/GetPeer\n\n# Update peer weights\ngrpcurl -plaintext -d \'{\n  "peerId": "12D3KooWTestPeer123456789",\n  "weights": 0.95,\n  "v": "0x1c",\n  "r": "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef",\n  "s": "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"\n}\' localhost:17002 peerpb.PeerDirectory/UpdatePeerWeights\n\n# Update recent buddy list\ngrpcurl -plaintext -d \'{\n  "peer_ids": ["12D3KooWTestPeer123456789", "12D3KooWAnotherPeer987654321"]\n}\' localhost:17002 peerpb.PeerDirectory/UpdateBuddy\n\n# List peers excluding recent buddies\ngrpcurl -plaintext -d \'{}\' localhost:17002 peerpb.PeerDirectory/ListBuddy\n\n# Send heartbeat\ngrpcurl -plaintext -d \'{\n  "heartbeat": {\n    "peerId": "12D3KooWTestPeer123456789",\n    "timestamp": 1735689600,\n    "status": "PEER_STATUS_ACTIVE",\n    "multiaddrs": ["/ip4/127.0.0.1/tcp/4001/p2p/12D3KooWTestPeer123456789"],\n    "signature": "heartbeat-signature"\n  }\n}\' localhost:17002 peerpb.PeerDirectory/SendHeartbeat\n'})}),"\n",(0,i.jsx)(n.h2,{id:"-project-structure",children:"\ud83d\udcc1 Project Structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"seedNodes/\n\u251c\u2500\u2500 cmd/                          # Application entry points\n\u2502   \u251c\u2500\u2500 jmns-service/            # Main peer directory service\n\u2502   \u251c\u2500\u2500 peer-ui/                 # Web UI for peer management\n\u2502   \u251c\u2500\u2500 hrw-exporter/            # HRW exporter service\n\u2502   \u251c\u2500\u2500 pg-cud-consumer/         # PostgreSQL CUD consumer\n\u2502   \u2514\u2500\u2500 seednode-grpc/           # Seed node gRPC service\n\u251c\u2500\u2500 pkg/                         # Core packages\n\u2502   \u251c\u2500\u2500 peer/                    # Peer directory implementation\n\u2502   \u2502   \u251c\u2500\u2500 models.go            # GORM database models\n\u2502   \u2502   \u251c\u2500\u2500 gorm_repository.go   # GORM repository layer\n\u2502   \u2502   \u251c\u2500\u2500 gorm_jmns_service.go # Main service implementation\n\u2502   \u2502   \u251c\u2500\u2500 peer_neighbor_repository.go # Neighbor management repository\n\u2502   \u2502   \u251c\u2500\u2500 inactive_neighbor_report_repository.go # Inactive reporting repository\n\u2502   \u2502   \u251c\u2500\u2500 inactive_neighbor_service.go # Inactive neighbor business logic\n\u2502   \u2502   \u251c\u2500\u2500 inactive_neighbor_config.go # Configuration for inactive reporting\n\u2502   \u2502   \u251c\u2500\u2500 peer_health_checker.go # Health check system\n\u2502   \u2502   \u251c\u2500\u2500 utils.go             # Utility functions\n\u2502   \u2502   \u251c\u2500\u2500 peer_directory_v2_test.go # Unit tests for v2 features\n\u2502   \u2502   \u251c\u2500\u2500 geolocation.go       # Basic geolocation service\n\u2502   \u2502   \u251c\u2500\u2500 geolocation_api.go   # HTTP API services\n\u2502   \u2502   \u251c\u2500\u2500 geolocation_config.go # Configuration management\n\u2502   \u2502   \u2514\u2500\u2500 geolocation_test.go  # Unit tests\n\u2502   \u251c\u2500\u2500 config/                  # Configuration management\n\u2502   \u251c\u2500\u2500 hrw/                     # HRW (Hash Ring Weight) implementation\n\u2502   \u251c\u2500\u2500 pgrepo/                  # PostgreSQL repository utilities\n\u2502   \u2514\u2500\u2500 rsclient/                # Redis Streams client\n\u251c\u2500\u2500 api/                         # Protocol definitions\n\u2502   \u251c\u2500\u2500 peer/                    # Peer directory gRPC API\n\u2502   \u2514\u2500\u2500 proto/                   # Redis Streams gRPC API\n\u251c\u2500\u2500 sql/                         # Database schema\n\u2502   \u2514\u2500\u2500 schema.sql               # PostgreSQL schema definition\n\u251c\u2500\u2500 test/                        # Test scripts and utilities\n\u2502   \u251c\u2500\u2500 test_peer_directory_v2.sh # Peer Directory v2 comprehensive tests\n\u2502   \u251c\u2500\u2500 test_schema_migration.sh  # Database schema migration tests\n\u2502   \u251c\u2500\u2500 test_region_detection.sh # IP geolocation tests\n\u2502   \u251c\u2500\u2500 test_register_peer.sh    # Peer registration tests\n\u2502   \u251c\u2500\u2500 test_jmns_service.sh     # Service integration tests\n\u2502   \u251c\u2500\u2500 test_db_health.sh        # Database health tests\n\u2502   \u2514\u2500\u2500 test_results_v2.md       # Test results documentation\n\u251c\u2500\u2500 examples/                    # Example code and demos\n\u2502   \u2514\u2500\u2500 geolocation_demo.go      # IP geolocation demo\n\u251c\u2500\u2500 scripts/                     # Setup and utility scripts\n\u251c\u2500\u2500 bin/                         # Built binaries\n\u251c\u2500\u2500 go.mod                       # Go module definition\n\u251c\u2500\u2500 go.sum                       # Go module checksums\n\u251c\u2500\u2500 README.md                    # This file\n\u2514\u2500\u2500 GEOLOCATION_SETUP.md         # IP geolocation setup guide\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-testing",children:"\ud83e\uddea Testing"}),"\n",(0,i.jsx)(n.h3,{id:"test-organization",children:"Test Organization"}),"\n",(0,i.jsxs)(n.p,{children:["All test files have been organized in the ",(0,i.jsx)(n.code,{children:"test/"})," folder:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"test/\n\u251c\u2500\u2500 test_db_health.sh      # Database health checks and auto-setup tests\n\u251c\u2500\u2500 test_jmns_service.sh   # Comprehensive JMNS service tests\n\u251c\u2500\u2500 test_register_peer.sh  # Peer registration tests\n\u2514\u2500\u2500 test_results.md        # Test results and documentation\n"})}),"\n",(0,i.jsx)(n.h3,{id:"running-tests",children:"Running Tests"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Database Health Check Tests"})," (NEW):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Test database health checks and automatic setup\n./test/test_db_health.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:"Tests:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"PostgreSQL connection validation"}),"\n",(0,i.jsx)(n.li,{children:"Automatic database creation"}),"\n",(0,i.jsx)(n.li,{children:"Schema application"}),"\n",(0,i.jsx)(n.li,{children:"Table existence validation"}),"\n",(0,i.jsx)(n.li,{children:"Error scenarios and fail-fast behavior"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"JMNS Service Tests"})," (GORM-based):"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./test/test_jmns_service.sh  # Comprehensive test suite\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Peer Registration"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./test/test_register_peer.sh\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"IP Geolocation"})," (NEW):"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./test/test_region_detection.sh  # Test IP geolocation functionality\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Peer Directory v2"})," (NEW):"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./test/test_peer_directory_v2.sh  # Test new normalized data model and features\n./test/test_schema_migration.sh  # Test database schema migration\n"})}),"\n",(0,i.jsx)(n.h3,{id:"test-coverage",children:"Test Coverage"}),"\n",(0,i.jsx)(n.p,{children:"The JMNS service test suite covers:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 Health checks"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Peer registration and updates"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Alias creation and management"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 IP geolocation and region detection"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Heartbeat functionality"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Batch operations"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Label filtering and pagination"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Error handling and validation"}),"\n",(0,i.jsxs)(n.li,{children:["\u2705 ",(0,i.jsx)(n.strong,{children:"Neighbor management (NEW)"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u2705 ",(0,i.jsx)(n.strong,{children:"Inactive peer reporting (NEW)"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u2705 ",(0,i.jsx)(n.strong,{children:"Health check system (NEW)"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u2705 ",(0,i.jsx)(n.strong,{children:"Data model normalization (NEW)"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u2705 ",(0,i.jsx)(n.strong,{children:"Time window filtering (NEW)"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u2705 ",(0,i.jsx)(n.strong,{children:"Database schema migration (NEW)"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"-troubleshooting",children:"\ud83d\udd27 Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"common-issues--solutions",children:"Common Issues & Solutions"}),"\n",(0,i.jsx)(n.h4,{id:"postgresql-not-running",children:(0,i.jsx)(n.strong,{children:"PostgreSQL Not Running"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"ERROR: PostgreSQL is not running or not accessible\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Start PostgreSQL service"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# macOS with Homebrew\nbrew services start postgresql\n\n# Linux with systemd\nsudo systemctl start postgresql\n\n# Docker\ndocker run --name postgres-jmns -e POSTGRES_PASSWORD=postgres -e POSTGRES_DB=postgres -p 5432:5432 -d postgres:15\n"})}),"\n",(0,i.jsx)(n.h4,{id:"database-permission-issues",children:(0,i.jsx)(n.strong,{children:"Database Permission Issues"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"ERROR: failed to create database 'jmns': permission denied\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Grant database creation privileges"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Connect to PostgreSQL as superuser\npsql -U postgres\n\n-- Grant privileges to your user\nALTER USER your_username CREATEDB;\n"})}),"\n",(0,i.jsx)(n.h4,{id:"schema-application-failed",children:(0,i.jsx)(n.strong,{children:"Schema Application Failed"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"ERROR: failed to apply schema: syntax error in SQL\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Check schema file syntax and permissions"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Verify schema file exists and is readable\nls -la sql/schema.sql\n\n# Check file permissions\nchmod 644 sql/schema.sql\n"})}),"\n",(0,i.jsx)(n.h4,{id:"service-wont-start",children:(0,i.jsx)(n.strong,{children:"Service Won't Start"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"ERROR: Database initialization failed\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Check logs for specific error details"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Run with verbose logging\n./jmns-service -pg-dsn="postgres://postgres:postgres@localhost:5432/jmns?sslmode=disable"\n'})}),"\n",(0,i.jsx)(n.h4,{id:"protobuf-field-errors",children:(0,i.jsx)(n.strong,{children:"Protobuf Field Errors"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"ERROR: message type peerpb.DeleteAliasRequest has no known field named alias_name\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Use correct field names in gRPC calls"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'// Correct\n{"alias": "alice.node.jmdt"}\n\n// Incorrect\n{"alias_name": "alice.node.jmdt"}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"service-configuration",children:"Service Configuration"}),"\n",(0,i.jsx)(n.h4,{id:"environment-variables-1",children:(0,i.jsx)(n.strong,{children:"Environment Variables"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# PostgreSQL connection\nexport PG_DSN="postgres://user:pass@host:port/dbname?sslmode=disable"\n\n# Schema file path\nexport SCHEMA_PATH="/path/to/schema.sql"\n\n# Start service\n./jmns-service\n'})}),"\n",(0,i.jsx)(n.h4,{id:"command-line-options",children:(0,i.jsx)(n.strong,{children:"Command Line Options"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Custom port\n./jmns-service -port 8080\n\n# Custom database\n./jmns-service -pg-dsn "postgres://user:pass@host:port/custom_db?sslmode=disable"\n\n# Custom schema path\n./jmns-service -schema-path "/path/to/custom/schema.sql"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"logging--monitoring",children:"Logging & Monitoring"}),"\n",(0,i.jsx)(n.p,{children:"The service provides detailed logging with status indicators:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Starting JMNS Service...\nPostgreSQL DSN: postgres://postgres:postgres@localhost:5432/jmns?sslmode=disable\nSchema path: sql/schema.sql\nPerforming database health checks...\n\u2713 PostgreSQL connection successful\n\u2713 Database 'jmns' exists\n\u2713 Required tables exist\n\u2713 Database initialization completed successfully\nCreating GORM JMNS service...\nPerforming final database validation...\n\u2713 Database validation successful\n\u2713 Simple Peer Directory gRPC server starting on port 17002\n\u2713 Local PeerID: 12D3KooW...\n\u2713 Service ready to accept connections\n"})}),"\n",(0,i.jsx)(n.h2,{id:"local-redis-streams-and-postgres",children:"Local Redis Streams and Postgres"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Start Redis Streams microservice (in ../Redis-Streams):"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"./RDS.sh start\n./RDS.sh run-microservice\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Ensure Postgres is reachable and PG_DSN is set before running consumers/exporters."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);